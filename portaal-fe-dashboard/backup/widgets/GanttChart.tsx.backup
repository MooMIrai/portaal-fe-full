import React from 'react';
import { Chart, ChartSeries, ChartSeriesItem, ChartValueAxis, ChartValueAxisItem, ChartCategoryAxis, ChartCategoryAxisItem } from '@progress/kendo-react-charts';

interface GanttData {
  title: string;
  start: Date;
  end: Date;
  color?: string;
}

interface GanttChartProps {
  data: GanttData[];
  style?: React.CSSProperties;
  height?: string | number;
}

/**
 * Custom Gantt Chart component that can be used in templates
 * This is a wrapper around Kendo's Chart component configured for Gantt-style visualization
 */
export const GanttChart: React.FC<GanttChartProps> = ({ data, style, height = '400px' }) => {
  // Convert data for range bar chart
  const chartData = data.map(item => ({
    ...item,
    start: new Date(item.start),
    end: new Date(item.end)
  }));

  // Calculate min and max dates for the chart
  const allDates = chartData.flatMap(item => [item.start, item.end]);
  const minDate = new Date(Math.min(...allDates.map(d => d.getTime())));
  const maxDate = new Date(Math.max(...allDates.map(d => d.getTime())));

  return (
    <Chart style={{ height, width: '100%', ...style }}>
      <ChartValueAxis>
        <ChartValueAxisItem
          type="date"
          baseUnit="days"
          min={minDate}
          max={maxDate}
          labels={{
            format: "dd/MM",
            rotation: "auto"
          }}
          majorGridLines={{
            visible: true
          }}
        />
      </ChartValueAxis>

      <ChartCategoryAxis>
        <ChartCategoryAxisItem
          categories={chartData.map(item => item.title)}
          reverse={true}
          line={{
            visible: false
          }}
          labels={{
            padding: { right: 10 }
          }}
        />
      </ChartCategoryAxis>

      <ChartSeries>
        <ChartSeriesItem
          type="rangeBar"
          data={chartData}
          fromField="start"
          toField="end"
          categoryField="title"
          colorField="color"
          color="#007bff"
        />
      </ChartSeries>
    </Chart>
  );
};

// Export a simplified version that works with template data
export const Gantt: React.FC<{ data?: any[]; [key: string]: any }> = ({ data = [], ...props }) => {
  // Transform data if needed
  const ganttData = data.map(item => ({
    title: item.title || item.name || 'Task',
    start: item.start instanceof Date ? item.start : new Date(item.start),
    end: item.end instanceof Date ? item.end : new Date(item.end),
    color: item.color || '#007bff'
  }));

  return <GanttChart data={ganttData} {...props} />;
};