"use strict";(self.webpackChunkportaal_mfe_hr=self.webpackChunkportaal_mfe_hr||[]).push([[234,167],{6876:(e,t,n)=>{n.r(t),n.d(t,{default:()=>v});var a=n(4914),r=n.n(a),i=n(1993),o=n(1530),s=n(5017),l=n(8515),u=n(6141),c=n.n(u),d=n(4414),f=n(3274);const v=function(){return r().createElement(c(),{data:[{path:"/personale",element:r().createElement(i.A,null),permissions:["READ_HR_EMPLOYEE"]},{path:"/rapportino",element:r().createElement(o.A,null),permissions:["READ_HR_TIMESHEET"]},{path:"/gestioneFeriePermessi",element:r().createElement(s.A,null),permissions:["READ_HR_HOLIDAY"]},{path:"/societa",element:r().createElement(l.A,null),permissions:["READ_HR_COMPANY"]},{path:"/attesaprogetto",element:r().createElement(d.j,null),permissions:["READ_RESOURCE_ALIGNMENT"]},{path:"/gestionerapportino",element:r().createElement(f.A,null),permissions:["READ_HR_TIMESHEET_DEAUTH"]}]})}},1167:(e,t,n)=>{n.r(t),n.d(t,{default:()=>O});var a=n(7136),r=n(7255),i=n(4914),o=n.n(i),s=n(1079),l=n(6501),u=n.n(l),c=n(3595),d=n.n(c),f=n(8715),v=n(8812),g=n(2557),h=n(7752),p=n.n(h),D=n(8500),m=n.n(D),E=n(2659),y=n(7708),w=n.n(y),_=n(8539),A=n.n(_),b=n(8386),q=n.n(b),S=n(8846),R=n(3069),T=n.n(R);function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){(0,a.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var H=p()((function(e){var t=void 0,n=void 0,a="";return e.request&&(null===e.request.approved?(t="rgb(255, 192, 0)",n="black",a="(Da approvare)"):e.request.approved?(t="green",a="(Approvata)"):(t="red",a="(Rifiutata)")),o().createElement("div",{style:{color:n,background:t,width:"100%",height:"100%",position:"absolute",right:0,left:0,top:0,bottom:0,textAlign:"center",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",fontSize:14}},e.request?null:"".concat(e.hours," ore - ")," ",e.title," ",a,"  ")}));function O(e){var t,n,a,l,c,h=e.forcePerson||{id:0,name:"(Me)"},p=(0,i.useState)(e.forceDate||new Date),D=(0,r.A)(p,2),y=D[0],_=D[1],b=(0,i.useState)([]),R=(0,r.A)(b,2),M=R[0],O=R[1],C=(0,i.useState)(),I=(0,r.A)(C,2),k=I[0],j=I[1],F=(0,i.useState)(),L=(0,r.A)(F,2),z=L[0],Y=L[1],x=(0,i.useState)(),U=(0,r.A)(x,2),N=U[0],W=U[1],V=(0,i.useState)(),B=(0,r.A)(V,2),G=B[0],J=B[1],K=(0,i.useState)(!1),Q=(0,r.A)(K,2),X=Q[0],Z=Q[1],$=(0,i.useState)(void 0),ee=(0,r.A)($,2),te=ee[0],ne=ee[1],ae=(0,i.useState)(h),re=(0,r.A)(ae,2),ie=re[0],oe=re[1],se=(0,i.useState)(!1),le=(0,r.A)(se,2),ue=le[0],ce=le[1],de=(0,i.useState)(),fe=(0,r.A)(de,2),ve=fe[0],ge=fe[1],he=(0,v.useWindowSize)(),pe=function(e,t,n,a,r){return new Date(Date.UTC(e,t-1,n,a,r,0,0)).toISOString()},De=function(){var e=y.getFullYear(),t=y.getMonth()+1;f.r.findOrCreate(e,t,"",ie.id>0?ie.id:void 0).then((function(n){W(n.id),j(n.holidays),Y(n.unavailable_days),ne(!(null==n||!n.finalized)),ge(y);var a=[];null==n||n.TimesheetDetail.forEach((function(n){n&&(ce(!1),a.push({request:n.LeaveRequest,activity:n.PersonActivity.Activity,person_activity_id:n.person_activity_id,id:n.id,title:n.PersonActivity.Activity.description,day:n.day,hours:n.hours,start:new Date(pe(e,t,n.day,9,0)),end:new Date(pe(e,t,n.day,18,0))}))})),O(function(e){var t=[],n={};for(var a in e.forEach((function(e){if(e.request){var a=e.request.id;if(n[a]){var r=new Date(e.start),i=new Date(e.end);r<n[a].start&&(n[a].start=r),i>n[a].end&&(n[a].end=i)}else n[a]=P(P({},e),{},{request:P({},e.request),start:new Date(e.start),end:new Date(e.end)})}else t.push(e)})),n){var r=n[a];r.start=r.start,r.end=r.end,t.push(r)}return t}(a))})).catch((function(e){console.error("Errore:",e),ce(!0)}))};return(0,i.useEffect)((function(){return De(),document.addEventListener("CalendarRefreshData",De),function(){document.removeEventListener("CalendarRefreshData",De)}}),[y,ie]),(0,i.useEffect)((function(){ue&&m().openConfirm("Data non valida verrà ripristinata la data precedente",(function(){ce(!1),ve&&_(ve)}),"Rapportino non disponibile",(function(){ce(!1),ve&&_(ve)}))}),[ue]),o().createElement(o().Fragment,null,e.forcePerson?null:o().createElement("div",{style:{display:"flex",flexDirection:he.width&&he.width>=768?"row":"column",justifyContent:"space-between",marginBottom:10}},o().createElement("p",null,"Tocca una data per inserire le ore di attività o trascina per selezionare più date"),o().createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end",gap:15}},T().hasPermission("READ_HR_TIMESHEET_DEAUTH")&&!e.forcePerson&&o().createElement("div",{style:{width:300}},"Utente Selezionato ",o().createElement(S.O,{label:"",value:ie,onChange:function(e){e.value?oe(e.value):oe(h)}})),null!=te&&T().hasPermission("WRITE_HR_TIMESHEET")&&o().createElement(A(),{style:{maxHeight:"min-content"},themeColor:"success",onClick:function(){M.some((function(e){return e.request&&(0,s.isNil)(e.request.approved)}))?m().openModal({icon:!0,style:"error"},"Impossibile consolidare rapportino con richieste non approvate."):Z(!0)},disabled:te&&!T().hasPermission("WRITE_HR_TIMESHEET_DEAUTH")},te?"Deconsolida":"Consolida"))),o().createElement(q(),{title:te?"Deconsolida":"Consolida",callToAction:"Conferma",showModalFooter:!0,height:250,isOpen:!!X,onClose:function(){return Z(!1)},onSubmit:function(){te?f.r.deconsolidateTimesheet(N||0).then((function(e){e&&ne(!1)})).finally((function(){Z(!1)})):f.r.finalizeTimesheet(N||0).then((function(e){e&&ne(!0)})).finally((function(){Z(!1)}))}},"L'operazione è irreversibile."),ue?o().createElement("div",null,"Data selezionata non valida"):he.width&&he.width>=768?o().createElement(u(),{date:y,model:{timeSheetsId:N},handleDateChange:function(e){var t=new Date,n=new Date(t.getFullYear()+1,t.getMonth(),1);new Date(e.value.getFullYear(),e.value.getMonth(),1)>n||_(e.value)},defaultView:"month",handleDataChange:function(){},data:M,contentModal:function(t,n){for(var a,r,i,s=[],l=new Date(t.start),u={},c={},d={},f=!1;l<t.end;){!f&&null!=k&&k.some((function(e){return e===l.getDate()}))&&(f=!0),s.push(new Date(l));var v=M.filter((function(e){if(e.request){var t=new Date(e.request.start_date),n=new Date(e.request.end_date);return t.getDate()<=l.getDate()&&n.getDate()>=l.getDate()}return e.start.getDate()<=l.getDate()&&e.end.getDate()>=l.getDate()}));v&&(u[l.getDate()]={},c[l.getDate()]={},v.forEach((function(e){u[l.getDate()][e.activity.id]=e.hours,c[l.getDate()][e.activity.id]=e.person_activity_id}))),M.filter((function(e){if(!e.request)return!1;var t=new Date(e.request.start_date);t.setHours(0,0,0,0);var n=new Date(e.request.end_date);return n.setHours(23,59,59,59),l>=t&&l<=n})).forEach((function(e){d[l.getDate()]||(d[l.getDate()]={});var t={hours:e.hours,approved:e.request.approve_date?new Date(e.request.approve_date):null,name:e.title,notes:e.request.notes};d[l.getDate()][e.activity.id]?d[l.getDate()][e.activity.id].push(t):d[l.getDate()][e.activity.id]=[t]})),l.setDate(l.getDate()+1)}return{component:o().createElement(g.A,{dates:s,timesheetId:N||0,values:u,assignment_values:c,hasHoliday:f,closeModal:function(){n(),De()},holidaysData:d,editLocked:!!e.forcePerson||te||!T().hasPermission("WRITE_HR_TIMESHEET")}),title:s.length>=2?(null===(a=s[0])||void 0===a?void 0:a.toLocaleDateString("it-IT"))+" - "+(null===(r=s[s.length-1])||void 0===r?void 0:r.toLocaleDateString("it-IT"))||"":null===(i=s[0])||void 0===i?void 0:i.toLocaleDateString("it-IT")}},item:H,holidays:k,unavailableDays:z,disableDrag:!!e.forcePerson,isFinalized:!e.forcePerson&&te}):o().createElement(o().Fragment,null,o().createElement(d(),{topView:"month",navigation:!0,focusedDate:y,data:M,cellProps:function(e){var t={style:{},hours:void 0},n=null==k?void 0:k.some((function(t){return e.value.getDate()===t&&e.value.getMonth()===y.getMonth()})),a=M.find((function(t){if(!t.request)return!1;var n=new Date(t.request.start_date),a=new Date(t.request.end_date);return n.getDate()<=e.value.getDate()&&a.getDate()>=e.value.getDate()&&e.value.getMonth()===y.getMonth()})),r=M.filter((function(t){return t.day===e.value.getDate()&&e.value.getMonth()===y.getMonth()}));return n&&(t.style.color="red"),a?(te?t.style.background="#e9ecef":!0===a.request.approved?t.style.background="green":a.request&&!1===a.request.approved?t.style.background="red":t.style.background="rgb(255, 192, 0)",t.hours=r.reduce((function(e,t){return e+t.hours}),0)):r.length&&(t.hours=r.reduce((function(e,t){return e+t.hours}),0)),t},header:function(e){return o().createElement(o().Fragment,null,o().createElement("p",{style:{marginLeft:10}},e.headerTitleProps.value),o().createElement("div",{style:{display:"flex",gap:10,marginRight:10}},o().createElement(A(),{onClick:function(){_(new Date(y.getFullYear(),y.getMonth()-1,y.getDate()))}},o().createElement(w(),{icon:E.chevronLeftIcon})),o().createElement(A(),{onClick:function(){_(new Date(y.getFullYear(),y.getMonth()+1,y.getDate()))}},o().createElement(w(),{icon:E.chevronRightIcon}))))},min:new Date(y.getFullYear(),y.getMonth(),1),max:new Date(y.getFullYear(),y.getMonth()+1,0),onChange:function(e){J(e.value)},isFinalized:!e.forcePerson&&te}),G&&(t=[],n={},a={},l=!1,c={},G&&(l=!!k&&k.some((function(e){return e===G.getDate()})),t.push(G),n[G.getDate()]={},M.filter((function(e){if(e.request){var t=new Date(e.request.start_date),n=new Date(e.request.end_date);return t.getDate()<=G.getDate()&&n.getDate()>=G.getDate()}return e.start.getDate()<=G.getDate()&&e.end.getDate()>=G.getDate()})).forEach((function(e){n[G.getDate()][e.activity.id]=e.hours,a[G.getDate()][e.activity.id]=e.person_activity_id})),M.filter((function(e){if(!e.request)return!1;var t=new Date(e.request.start_date);t.setHours(0,0,0,0);var n=new Date(e.request.end_date);return n.setHours(23,59,59,59),G>=t&&G<=n})).forEach((function(e){c[G.getDate()]||(c[G.getDate()]={});var t={hours:e.hours,approved:e.request.approve_date?new Date(e.request.approve_date):null,name:e.title};c[G.getDate()][e.activity.id]?c[G.getDate()][e.activity.id].push(t):c[G.getDate()][e.activity.id]=[t]}))),o().createElement(g.A,{dates:t,timesheetId:N||0,values:n,assignment_values:a,hasHoliday:l,closeModal:function(){document.dispatchEvent(new CustomEvent("CalendarRefreshData"))},holidaysData:c,editLocked:!!e.forcePerson||te}))))}}}]);
//# sourceMappingURL=234.js.map