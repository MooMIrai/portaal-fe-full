"use strict";(self.webpackChunkportaal_mfe_hr=self.webpackChunkportaal_mfe_hr||[]).push([[167],{1167:(e,t,n)=>{n.r(t),n.d(t,{default:()=>I});var a=n(7136),r=n(7255),i=n(4914),o=n.n(i),s=n(1079),u=n(6501),l=n.n(u),c=n(3595),d=n.n(c),f=n(8715),v=n(8812),g=n(2557),h=n(7752),D=n.n(h),p=n(8500),m=n.n(p),y=n(2659),w=n(7708),E=n.n(w),_=n(8539),b=n.n(_),q=n(8386),S=n.n(q),A=n(8846),P=n(3069),C=n.n(P);function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){(0,a.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O=D()((function(e){var t=void 0,n=void 0,a="";return e.request&&(null===e.request.approved?(t="rgb(255, 192, 0)",n="black",a="(Da approvare)"):e.request.approved?(t="green",a="(Approvata)"):(t="red",a="(Rifiutata)")),o().createElement("div",{style:{color:n,background:t,width:"100%",height:"100%",position:"absolute",right:0,left:0,top:0,bottom:0,textAlign:"center",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",fontSize:14}},e.request?null:"".concat(e.hours," ore - ")," ",e.title," ",a,"  ")}));function I(e){var t,n,a,u,c,h=e.forcePerson||{id:0,name:"(Me)"},D=(0,i.useState)(e.forceDate||new Date),p=(0,r.A)(D,2),w=p[0],_=p[1],q=(0,i.useState)([]),P=(0,r.A)(q,2),M=P[0],I=P[1],H=(0,i.useState)(),k=(0,r.A)(H,2),R=k[0],j=k[1],F=(0,i.useState)(),L=(0,r.A)(F,2),z=L[0],x=L[1],Y=(0,i.useState)(),U=(0,r.A)(Y,2),W=U[0],V=U[1],B=(0,i.useState)(),N=(0,r.A)(B,2),G=N[0],J=N[1],K=(0,i.useState)(!1),Q=(0,r.A)(K,2),X=Q[0],Z=Q[1],$=(0,i.useState)(void 0),ee=(0,r.A)($,2),te=ee[0],ne=ee[1],ae=(0,i.useState)(h),re=(0,r.A)(ae,2),ie=re[0],oe=re[1],se=(0,i.useState)(!1),ue=(0,r.A)(se,2),le=ue[0],ce=ue[1],de=(0,i.useState)(),fe=(0,r.A)(de,2),ve=fe[0],ge=fe[1],he=(0,v.useWindowSize)(),De=function(e,t,n,a,r){return new Date(Date.UTC(e,t-1,n,a,r,0,0)).toISOString()},pe=function(){var e=w.getFullYear(),t=w.getMonth()+1;f.r.findOrCreate(e,t,"",ie.id>0?ie.id:void 0).then((function(n){V(n.id),j(n.holidays),x(n.unavailable_days),ne(!(null==n||!n.finalized)),ge(w);var a=[];null==n||n.TimesheetDetail.forEach((function(n){n&&(ce(!1),a.push({request:n.LeaveRequest,activity:n.PersonActivity.Activity,person_activity_id:n.person_activity_id,id:n.id,title:n.PersonActivity.Activity.description,day:n.day,hours:n.hours,start:new Date(De(e,t,n.day,9,0)),end:new Date(De(e,t,n.day,18,0))}))})),I(function(e){var t=[],n={};for(var a in e.forEach((function(e){if(e.request){var a=e.request.id;if(n[a]){var r=new Date(e.start),i=new Date(e.end);r<n[a].start&&(n[a].start=r),i>n[a].end&&(n[a].end=i)}else n[a]=T(T({},e),{},{request:T({},e.request),start:new Date(e.start),end:new Date(e.end)})}else t.push(e)})),n){var r=n[a];r.start=r.start,r.end=r.end,t.push(r)}return t}(a))})).catch((function(e){console.error("Errore:",e),ce(!0)}))};return(0,i.useEffect)((function(){return pe(),document.addEventListener("CalendarRefreshData",pe),function(){document.removeEventListener("CalendarRefreshData",pe)}}),[w,ie]),(0,i.useEffect)((function(){le&&m().openConfirm("Data non valida verrà ripristinata la data precedente",(function(){ce(!1),ve&&_(ve)}),"Rapportino non disponibile",(function(){ce(!1),ve&&_(ve)}))}),[le]),o().createElement(o().Fragment,null,e.forcePerson?null:o().createElement("div",{style:{display:"flex",flexDirection:he.width&&he.width>=768?"row":"column",justifyContent:"space-between",marginBottom:10}},o().createElement("p",null,"Tocca una data per inserire le ore di attività o trascina per selezionare più date"),o().createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end",gap:15}},C().hasPermission("READ_HR_TIMESHEET_DEAUTH")&&!e.forcePerson&&o().createElement("div",{style:{width:300}},"Utente Selezionato ",o().createElement(A.O,{label:"",value:ie,onChange:function(e){e.value?oe(e.value):oe(h)}})),null!=te&&C().hasPermission("WRITE_HR_TIMESHEET")&&o().createElement(b(),{style:{maxHeight:"min-content"},themeColor:"success",onClick:function(){M.some((function(e){return e.request&&(0,s.isNil)(e.request.approved)}))?m().openModal({icon:!0,style:"error"},"Impossibile consolidare rapportino con richieste non approvate."):Z(!0)},disabled:te&&!C().hasPermission("WRITE_HR_TIMESHEET_DEAUTH")},te?"Deconsolida":"Consolida"))),o().createElement(S(),{title:te?"Deconsolida":"Consolida",callToAction:"Conferma",showModalFooter:!0,height:250,isOpen:!!X,onClose:function(){return Z(!1)},onSubmit:function(){te?f.r.deconsolidateTimesheet(W||0).then((function(e){e&&ne(!1)})).finally((function(){Z(!1)})):f.r.finalizeTimesheet(W||0).then((function(e){e&&ne(!0)})).finally((function(){Z(!1)}))}},"L'operazione è irreversibile."),le?o().createElement("div",null,"Data selezionata non valida"):he.width&&he.width>=768?o().createElement(l(),{date:w,model:{timeSheetsId:W},handleDateChange:function(e){var t=new Date,n=new Date(t.getFullYear()+1,t.getMonth(),1);new Date(e.value.getFullYear(),e.value.getMonth(),1)>n||_(e.value)},defaultView:"month",handleDataChange:function(){},data:M,contentModal:function(t,n){for(var a,r,i,s=[],u=new Date(t.start),l={},c={},d={},f=!1;u<t.end;){!f&&null!=R&&R.some((function(e){return e===u.getDate()}))&&(f=!0),s.push(new Date(u));var v=M.filter((function(e){if(e.request){var t=new Date(e.request.start_date),n=new Date(e.request.end_date);return t.getDate()<=u.getDate()&&n.getDate()>=u.getDate()}return e.start.getDate()<=u.getDate()&&e.end.getDate()>=u.getDate()}));v&&(l[u.getDate()]={},c[u.getDate()]={},v.forEach((function(e){l[u.getDate()][e.activity.id]=e.hours,c[u.getDate()][e.activity.id]=e.person_activity_id}))),M.filter((function(e){if(!e.request)return!1;var t=new Date(e.request.start_date);t.setHours(0,0,0,0);var n=new Date(e.request.end_date);return n.setHours(23,59,59,59),u>=t&&u<=n})).forEach((function(e){d[u.getDate()]||(d[u.getDate()]={});var t={hours:e.hours,approved:e.request.approve_date?new Date(e.request.approve_date):null,name:e.title,notes:e.request.notes};d[u.getDate()][e.activity.id]?d[u.getDate()][e.activity.id].push(t):d[u.getDate()][e.activity.id]=[t]})),u.setDate(u.getDate()+1)}return{component:o().createElement(g.A,{dates:s,timesheetId:W||0,values:l,assignment_values:c,hasHoliday:f,closeModal:function(){n(),pe()},holidaysData:d,editLocked:!!e.forcePerson||te||!C().hasPermission("WRITE_HR_TIMESHEET")}),title:s.length>=2?(null===(a=s[0])||void 0===a?void 0:a.toLocaleDateString("it-IT"))+" - "+(null===(r=s[s.length-1])||void 0===r?void 0:r.toLocaleDateString("it-IT"))||"":null===(i=s[0])||void 0===i?void 0:i.toLocaleDateString("it-IT")}},item:O,holidays:R,unavailableDays:z,disableDrag:!!e.forcePerson,isFinalized:!e.forcePerson&&te}):o().createElement(o().Fragment,null,o().createElement(d(),{topView:"month",navigation:!0,focusedDate:w,data:M,cellProps:function(e){var t={style:{},hours:void 0},n=null==R?void 0:R.some((function(t){return e.value.getDate()===t&&e.value.getMonth()===w.getMonth()})),a=M.find((function(t){if(!t.request)return!1;var n=new Date(t.request.start_date),a=new Date(t.request.end_date);return n.getDate()<=e.value.getDate()&&a.getDate()>=e.value.getDate()&&e.value.getMonth()===w.getMonth()})),r=M.filter((function(t){return t.day===e.value.getDate()&&e.value.getMonth()===w.getMonth()}));return n&&(t.style.color="red"),a?(te?t.style.background="#e9ecef":!0===a.request.approved?t.style.background="green":a.request&&!1===a.request.approved?t.style.background="red":t.style.background="rgb(255, 192, 0)",t.hours=r.reduce((function(e,t){return e+t.hours}),0)):r.length&&(t.hours=r.reduce((function(e,t){return e+t.hours}),0)),t},header:function(e){return o().createElement(o().Fragment,null,o().createElement("p",{style:{marginLeft:10}},e.headerTitleProps.value),o().createElement("div",{style:{display:"flex",gap:10,marginRight:10}},o().createElement(b(),{onClick:function(){_(new Date(w.getFullYear(),w.getMonth()-1,w.getDate()))}},o().createElement(E(),{icon:y.chevronLeftIcon})),o().createElement(b(),{onClick:function(){_(new Date(w.getFullYear(),w.getMonth()+1,w.getDate()))}},o().createElement(E(),{icon:y.chevronRightIcon}))))},min:new Date(w.getFullYear(),w.getMonth(),1),max:new Date(w.getFullYear(),w.getMonth()+1,0),onChange:function(e){J(e.value)},isFinalized:!e.forcePerson&&te}),G&&(t=[],n={},a={},u=!1,c={},G&&(u=!!R&&R.some((function(e){return e===G.getDate()})),t.push(G),n[G.getDate()]={},M.filter((function(e){if(e.request){var t=new Date(e.request.start_date),n=new Date(e.request.end_date);return t.getDate()<=G.getDate()&&n.getDate()>=G.getDate()}return e.start.getDate()<=G.getDate()&&e.end.getDate()>=G.getDate()})).forEach((function(e){n[G.getDate()][e.activity.id]=e.hours,a[G.getDate()][e.activity.id]=e.person_activity_id})),M.filter((function(e){if(!e.request)return!1;var t=new Date(e.request.start_date);t.setHours(0,0,0,0);var n=new Date(e.request.end_date);return n.setHours(23,59,59,59),G>=t&&G<=n})).forEach((function(e){c[G.getDate()]||(c[G.getDate()]={});var t={hours:e.hours,approved:e.request.approve_date?new Date(e.request.approve_date):null,name:e.title};c[G.getDate()][e.activity.id]?c[G.getDate()][e.activity.id].push(t):c[G.getDate()][e.activity.id]=[t]}))),o().createElement(g.A,{dates:t,timesheetId:W||0,values:n,assignment_values:a,hasHoliday:u,closeModal:function(){document.dispatchEvent(new CustomEvent("CalendarRefreshData"))},holidaysData:c,editLocked:!!e.forcePerson||te}))))}}}]);
//# sourceMappingURL=167.js.map